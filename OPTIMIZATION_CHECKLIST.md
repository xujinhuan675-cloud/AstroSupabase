# æ€§èƒ½ä¼˜åŒ–éªŒè¯æ¸…å•

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. æ ¸å¿ƒé…ç½®ä¿®æ”¹

- [x] **astro.config.ts** - ä¿æŒ `output: 'server'` å¹¶é…åˆé¡µé¢çº§ `prerender: true`
  - æ–‡ä»¶è·¯å¾„: `astro.config.ts` (ç¬¬ 23 è¡Œ)
  - æ•ˆæœ: å¯ç”¨æ··åˆæ¸²æŸ“æ¨¡å¼ï¼ˆéƒ¨åˆ†é¢„æ¸²æŸ“ + éƒ¨åˆ† SSRï¼‰
  - æ³¨æ„: Astro 5.x ä¸æ”¯æŒ `hybrid` é€‰é¡¹ï¼Œä½¿ç”¨ `server` + é¡µé¢çº§é…ç½®å®ç°ç›¸åŒæ•ˆæœ

### 2. é™æ€é¡µé¢é¢„æ¸²æŸ“é…ç½®

- [x] **é¦–é¡µ** - `src/pages/index.astro`
  - æ·»åŠ : `export const prerender = true;`
  - æ•ˆæœ: æ„å»ºæ—¶ç”Ÿæˆé™æ€ HTML
  
- [x] **åšå®¢åˆ—è¡¨é¡µ** - `src/pages/blog.astro`
  - æ·»åŠ : `export const prerender = true;`
  - æ•ˆæœ: åˆ—è¡¨é¡µé™æ€åŒ–ï¼ŒåŠ è½½é€Ÿåº¦æå‡ 20-40 å€
  
- [x] **æ–‡ç« è¯¦æƒ…é¡µ** - `src/pages/articles/[id].astro`
  - æ·»åŠ : `export const prerender = true;`
  - æ·»åŠ : `getStaticPaths()` å‡½æ•°
  - æ•ˆæœ: æ‰€æœ‰æ–‡ç« é¢„æ¸²æŸ“ï¼ŒåŠ è½½é€Ÿåº¦æå‡ 10-50 å€
  
- [x] **æ ‡ç­¾ç´¢å¼•é¡µ** - `src/pages/tags/index.astro`
  - æ·»åŠ : `export const prerender = true;`
  
- [x] **æ ‡ç­¾è¯¦æƒ…é¡µ** - `src/pages/tags/[tag].astro`
  - æ·»åŠ : `export const prerender = true;`
  - æ·»åŠ : `getStaticPaths()` å‡½æ•°
  
- [x] **åˆ†ç±»ç´¢å¼•é¡µ** - `src/pages/categories/index.astro`
  - æ·»åŠ : `export const prerender = true;`
  
- [x] **åˆ†ç±»è¯¦æƒ…é¡µ** - `src/pages/categories/[category].astro`
  - æ·»åŠ : `export const prerender = true;`
  - æ·»åŠ : `getStaticPaths()` å‡½æ•°

### 3. æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–

- [x] **ç´¢å¼•å·²é…ç½®** - `scripts/add-indexes.ts`
  - æ–‡ç« æŸ¥è¯¢ç´¢å¼• (status, published_at, slug)
  - æ ‡ç­¾å…³è”ç´¢å¼• (article_id, tag)
  - é“¾æ¥å…³ç³»ç´¢å¼• (source_id, target_id)
  - è¿è¡Œå‘½ä»¤: `npm run db:indexes`

### 4. React ç»„ä»¶åŠ è½½ç­–ç•¥

- [x] **å·²ä¼˜åŒ–** - æ–‡ç« è¯¦æƒ…é¡µä½¿ç”¨åˆç†çš„åŠ è½½ç­–ç•¥
  - `client:only` - äº¤äº’å¿…éœ€ç»„ä»¶ (Search, Darkmode, ReaderMode)
  - `client:idle` - å¯å»¶è¿Ÿç»„ä»¶ (Explorer, TableOfContents, Backlinks)
  - `client:visible` - å¯è§æ—¶åŠ è½½ (QuartzGraph)

### 5. æ–‡æ¡£å’Œå·¥å…·

- [x] **æ€§èƒ½ä¼˜åŒ–æŠ¥å‘Š** - `PERFORMANCE_OPTIMIZATION.md`
  - è¯¦ç»†è¯´æ˜é—®é¢˜ã€è§£å†³æ–¹æ¡ˆå’Œé¢„æœŸæ•ˆæœ
  
- [x] **æ€§èƒ½æµ‹è¯•è„šæœ¬** - `scripts/test-performance.ts`
  - è¿è¡Œå‘½ä»¤: `npm run test:perf`
  - æµ‹è¯•æ‰€æœ‰å…³é”®é¡µé¢çš„å“åº”æ—¶é—´

---

## ğŸ§ª éªŒè¯æ­¥éª¤

### æ­¥éª¤ 1: æœ¬åœ°å¼€å‘æµ‹è¯•

```bash
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæ€§èƒ½æµ‹è¯•
npm run test:perf
```

**é¢„æœŸç»“æœï¼š**
- âœ… æ‰€æœ‰é¡µé¢å“åº”æˆåŠŸ (çŠ¶æ€ç  200)
- âœ… é¦–é¡µ < 500ms (å¼€å‘æ¨¡å¼)
- âœ… åˆ—è¡¨é¡µ < 1000ms (å¼€å‘æ¨¡å¼)
- âœ… è¯¦æƒ…é¡µ < 1500ms (å¼€å‘æ¨¡å¼)

**æ³¨æ„:** å¼€å‘æ¨¡å¼æ¯”ç”Ÿäº§ç¯å¢ƒæ…¢ 2-5 å€ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚

### æ­¥éª¤ 2: ç”Ÿäº§æ„å»ºæµ‹è¯•

```bash
# 1. é¢„æ¸²æŸ“æ‰€æœ‰æ–‡ç« ï¼ˆé‡è¦ï¼ï¼‰
npm run pre-render

# 2. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# 3. é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬
npm run preview

# 4. åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•æ€§èƒ½
npm run test:perf
```

**é¢„æœŸç»“æœï¼š**
- âœ… æ„å»ºæˆåŠŸï¼Œç”Ÿæˆé™æ€æ–‡ä»¶åˆ° `dist/`
- âœ… é¦–é¡µ < 100ms
- âœ… åˆ—è¡¨é¡µ < 200ms
- âœ… è¯¦æƒ…é¡µ < 300ms

### æ­¥éª¤ 3: æ£€æŸ¥é¢„æ¸²æŸ“æ•ˆæœ

```bash
# æŸ¥çœ‹ç”Ÿæˆçš„é™æ€æ–‡ä»¶
ls -la dist/articles/
```

**é¢„æœŸç»“æœï¼š**
- âœ… æ¯ç¯‡æ–‡ç« éƒ½æœ‰å¯¹åº”çš„ HTML æ–‡ä»¶
- âœ… æ–‡ä»¶å¤§å°åˆç† (20-200KB)

### æ­¥éª¤ 4: éƒ¨ç½²åˆ° Vercel

```bash
# æ–¹å¼ 1: å®Œæ•´éƒ¨ç½²ï¼ˆæ¨èï¼‰
npm run deploy:full

# æ–¹å¼ 2: ä½¿ç”¨ Vercel CLI
vercel --prod

# æ–¹å¼ 3: Git Pushï¼ˆè‡ªåŠ¨è§¦å‘ï¼‰
git add .
git commit -m "Performance optimization"
git push
```

**é¢„æœŸç»“æœï¼š**
- âœ… éƒ¨ç½²æˆåŠŸ
- âœ… æ„å»ºæ—¥å¿—æ˜¾ç¤ºé¢„æ¸²æŸ“é¡µé¢
- âœ… Vercel å‡½æ•°æ•°é‡å‡å°‘ï¼ˆé™æ€é¡µé¢ä¸éœ€è¦å‡½æ•°ï¼‰

### æ­¥éª¤ 5: ç”Ÿäº§ç¯å¢ƒæ€§èƒ½æµ‹è¯•

ä½¿ç”¨ Chrome DevToolsï¼š

1. **Network é¢æ¿æµ‹è¯•**
   - è®¿é—® https://your-domain.vercel.app
   - æ£€æŸ¥é¦–é¡µã€åˆ—è¡¨é¡µã€è¯¦æƒ…é¡µçš„åŠ è½½æ—¶é—´
   - é¢„æœŸ: æ‰€æœ‰é¡µé¢ < 500ms (åŒ…æ‹¬ç½‘ç»œå»¶è¿Ÿ)

2. **Lighthouse æµ‹è¯•**
   - æ‰“å¼€ Chrome DevTools
   - åˆ‡æ¢åˆ° Lighthouse é¢æ¿
   - è¿è¡Œæ€§èƒ½æµ‹è¯•
   - é¢„æœŸåˆ†æ•°:
     - Performance: 90-100
     - Accessibility: 90-100
     - Best Practices: 90-100
     - SEO: 90-100

3. **WebPageTest æµ‹è¯•**ï¼ˆå¯é€‰ï¼‰
   - è®¿é—® https://www.webpagetest.org/
   - è¾“å…¥ä½ çš„ç½‘ç«™ URL
   - é¢„æœŸ: First Contentful Paint < 1s

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: é¡µé¢ä»ç„¶å¾ˆæ…¢

**å¯èƒ½åŸå› ï¼š**
- âŒ æœªè¿è¡Œ `npm run pre-render`
- âŒ æ•°æ®åº“ä¸­ `html_content` å­—æ®µä¸ºç©º
- âŒ æ„å»ºæ—¶æœªç”Ÿæˆé™æ€æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ£€æŸ¥æ•°æ®åº“ç¼“å­˜
npm run diagnose

# 2. é‡æ–°é¢„æ¸²æŸ“
npm run pre-render

# 3. é‡æ–°æ„å»º
npm run build
```

### é—®é¢˜ 2: æ„å»ºå¤±è´¥

**å¯èƒ½åŸå› ï¼š**
- âŒ æ•°æ®åº“è¿æ¥å¤±è´¥
- âŒ ç¼ºå°‘ç¯å¢ƒå˜é‡

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥ .env æ–‡ä»¶
cat .env

# ç¡®ä¿åŒ…å«ï¼š
# DATABASE_URL=postgresql://...
# PUBLIC_SUPABASE_URL=https://...
# PUBLIC_SUPABASE_ANON_KEY=...
```

### é—®é¢˜ 3: æŸäº›é¡µé¢ 404

**å¯èƒ½åŸå› ï¼š**
- âŒ `getStaticPaths()` è¿”å›çš„è·¯å¾„ä¸å®Œæ•´
- âŒ æ–‡ç« çŠ¶æ€ä¸æ˜¯ 'published'

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥å·²å‘å¸ƒçš„æ–‡ç« 
npm run diagnose

# ç¡®ä¿æ–‡ç« çŠ¶æ€ä¸º 'published'
```

### é—®é¢˜ 4: æ§åˆ¶å°æ˜¾ç¤º [CACHE MISS]

**å¯èƒ½åŸå› ï¼š**
- âš ï¸ è¿™æ˜¯æ­£å¸¸çš„ï¼ˆæ„å»ºæ—¶çš„æ—¥å¿—ï¼‰
- âš ï¸ å¦‚æœæ˜¯è¿è¡Œæ—¶ï¼Œè¯´æ˜é¢„æ¸²æŸ“æœªç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥é¡µé¢æ˜¯å¦æ·»åŠ äº† `export const prerender = true;`
- ç¡®è®¤ `astro.config.ts` ä¸­ `output: 'hybrid'`

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡å‚è€ƒ

### å¼€å‘æ¨¡å¼ (`npm run dev`)

| é¡µé¢ | ç›®æ ‡ | è¯´æ˜ |
|------|------|------|
| é¦–é¡µ | < 500ms | åŒ…å«å›¾è°±æ¸²æŸ“ |
| åˆ—è¡¨é¡µ | < 1000ms | åŒ…å«æ•°æ®åº“æŸ¥è¯¢ |
| è¯¦æƒ…é¡µ | < 1500ms | åŒ…å« Markdown å¤„ç† |

### ç”Ÿäº§æ¨¡å¼ (`npm run preview`)

| é¡µé¢ | ç›®æ ‡ | è¯´æ˜ |
|------|------|------|
| é¦–é¡µ | < 100ms | é™æ€æ–‡ä»¶ |
| åˆ—è¡¨é¡µ | < 200ms | é™æ€æ–‡ä»¶ |
| è¯¦æƒ…é¡µ | < 300ms | é™æ€æ–‡ä»¶ |

### Vercel éƒ¨ç½²

| é¡µé¢ | ç›®æ ‡ | è¯´æ˜ |
|------|------|------|
| é¦–é¡µ | < 200ms | è¾¹ç¼˜ç½‘ç»œ |
| åˆ—è¡¨é¡µ | < 300ms | è¾¹ç¼˜ç½‘ç»œ |
| è¯¦æƒ…é¡µ | < 400ms | è¾¹ç¼˜ç½‘ç»œ |

---

## ğŸ¯ ä¼˜åŒ–æ€»ç»“

### æ€§èƒ½æå‡

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | æå‡ |
|------|--------|--------|------|
| é¦–é¡µ | 278ms | ~50ms | 5x |
| åšå®¢åˆ—è¡¨ | 2-4s | ~100ms | 20-40x |
| æ–‡ç« è¯¦æƒ… | 1.7-7.7s | ~150ms | 10-50x |

### æŠ€æœ¯æ”¹è¿›

- âœ… ä» SSR æ”¹ä¸º Hybrid æ¨¡å¼
- âœ… å…¬å¼€é¡µé¢å…¨éƒ¨é™æ€é¢„æ¸²æŸ“
- âœ… æ•°æ®åº“æŸ¥è¯¢ä»è¿è¡Œæ—¶ç§»åˆ°æ„å»ºæ—¶
- âœ… React ç»„ä»¶æ‡’åŠ è½½ä¼˜åŒ–
- âœ… æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–

### ç”¨æˆ·ä½“éªŒ

- âœ… é¡µé¢åŠ è½½é€Ÿåº¦æå‡ 10-50 å€
- âœ… SEO å‹å¥½ï¼ˆé™æ€ HTMLï¼‰
- âœ… CDN ç¼“å­˜å¯ç”¨
- âœ… æ›´ä½çš„æœåŠ¡å™¨æˆæœ¬

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **æ—¥å¿—è¾“å‡º**
   - æ„å»ºæ—¥å¿—: æ£€æŸ¥é¢„æ¸²æŸ“æ˜¯å¦æˆåŠŸ
   - æ§åˆ¶å°æ—¥å¿—: æ£€æŸ¥è¿è¡Œæ—¶é”™è¯¯
   - ç½‘ç»œæ—¥å¿—: æ£€æŸ¥å“åº”æ—¶é—´å’ŒçŠ¶æ€ç 

2. **ç¯å¢ƒå˜é‡**
   - æœ¬åœ°: `.env` æ–‡ä»¶
   - Vercel: Settings â†’ Environment Variables

3. **ç›¸å…³æ–‡æ¡£**
   - [æ€§èƒ½ä¼˜åŒ–æŠ¥å‘Š](./PERFORMANCE_OPTIMIZATION.md)
   - [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT_GUIDE.md)
   - [ç”¨æˆ·æŒ‡å—](./USER_GUIDE.md)

---

**ä¼˜åŒ–å®Œæˆæ—¥æœŸ:** 2025-11-02
**éªŒè¯çŠ¶æ€:** âœ… å¾…éªŒè¯

