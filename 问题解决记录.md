# Astro-Supabase 部署问题解决记录

## 问题概述
Vercel部署后出现空白页面，需要解决数据库连接和认证配置问题。

## 问题1：数据库连接错误
**错误信息：**
```
Error: getaddrinfo ENOTFOUND db.lvueuvuiavvchysfuobi.supabase.co
```

**原因：** Supabase数据库连接字符串配置错误

**解决方案：**
1. 在Supabase项目设置中获取正确的Session pooler连接字符串
2. 更新Vercel环境变量：
   ```
   DATABASE_URL="postgresql://postgres.lvueuvuiavvchysfuobi:[PASSWORD]@aws-1-ap-south-1.pooler.supabase.com:5432/postgres"
   ```

## 问题2：数据库表不存在
**错误信息：**
```
PostgresError: relation "articles" does not exist
```

**原因：** 数据库中没有创建必要的表结构

**解决方案：**
在Supabase SQL编辑器中执行以下SQL脚本：

```sql
-- 创建 users 表
CREATE TABLE "users" (
	"id" serial PRIMARY KEY NOT NULL,
	"name" text NOT NULL,
	"email" text NOT NULL,
	"created_at" timestamp DEFAULT now() NOT NULL,
	"updated_at" timestamp DEFAULT now() NOT NULL,
	CONSTRAINT "users_email_unique" UNIQUE("email")
);

-- 创建 tasks 表
CREATE TABLE "tasks" (
	"id" serial PRIMARY KEY NOT NULL,
	"title" text NOT NULL,
	"is_complete" boolean DEFAULT false NOT NULL,
	"created_at" timestamp DEFAULT now() NOT NULL,
	"updated_at" timestamp DEFAULT now() NOT NULL
);

-- 创建 articles 表
CREATE TABLE "articles" (
	"id" serial PRIMARY KEY NOT NULL,
	"title" text NOT NULL,
	"slug" text NOT NULL,
	"excerpt" text,
	"content" text NOT NULL,
	"author_id" text NOT NULL,
	"created_at" timestamp DEFAULT now() NOT NULL,
	"updated_at" timestamp DEFAULT now() NOT NULL
);
```

## 问题3：OAuth提供者未启用
**错误信息：**
```
{"code":400,"error_code":"validation_failed","msg":"Unsupported provider: provider is not enabled"}
```

**原因：** Supabase中Google和GitHub OAuth提供者未启用

**解决方案：**
1. 访问Supabase认证提供者设置页面
2. 启用Google提供者：
   - 点击Google配置
   - 开启"Sign in with Google"开关
   - 保存配置
3. 启用GitHub提供者：
   - 点击GitHub配置
   - 开启"Sign in with GitHub"开关
   - 保存配置

## 问题4：创建管理员账户
**需求：** 创建可直接登录的管理员账户

**解决方案：**
1. 在Supabase用户管理页面点击"Add user"
2. 填写用户信息：
   - Email: admin@example.com
   - Password: [设置密码]
   - 勾选"Auto Confirm User"
3. 保存用户

## 环境变量配置
确保Vercel中配置了以下环境变量：
```
DATABASE_URL="postgresql://postgres.lvueuvuiavvchysfuobi:[PASSWORD]@aws-1-ap-south-1.pooler.supabase.com:5432/postgres"
PUBLIC_SUPABASE_URL="https://lvueuvuiavvchysfuobi.supabase.co"
PUBLIC_SUPABASE_ANON_KEY="[YOUR_ANON_KEY]"
PUBLIC_SITE_URL="https://astro-supabase-three.vercel.app/"
```

## 验证结果
- ✅ 数据库连接正常
- ✅ 数据库表结构完整
- ✅ OAuth提供者已启用
- ✅ 登录页面正常显示
- ✅ 管理员账户可正常登录

## 后续配置
如需配置Google OAuth的Client ID和Client Secret：
1. 在Google Cloud Console创建OAuth应用
2. 获取Client ID和Client Secret
3. 在Supabase Google提供者配置中填入凭据
4. 设置重定向URL为：`https://lvueuvuiavvchysfuobi.supabase.co/auth/v1/callback`
