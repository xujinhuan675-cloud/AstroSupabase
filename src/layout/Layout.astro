---
import { ClientRouter } from 'astro:transitions';
import SpeedInsights from '@vercel/speed-insights/astro';
import '../styles/global.css';
import '../styles/quartz/variables.css';
import '../styles/quartz/darkmode.css';
import '../styles/quartz/popover.css';
import '../styles/quartz/clipboard.css';
import '../styles/quartz/recentnotes.css';
import '../styles/quartz/listpage.css';
import '../styles/quartz/mermaid.css';
import Darkmode from '../components/quartz/Darkmode';

interface Props {
  title?: string;
}

const { title = 'Todo App' } = Astro.props;
---
<!DOCTYPE html>
<html lang="zh-CN" class="h-full">
  <head>
    <!-- Google Tag Manager -->
    <script is:inline>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-WSSXP26S');
    </script>
    <!-- End Google Tag Manager -->
    
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="A simple todo application" />
    <title>{title}</title>
    <ClientRouter />
  </head>
  <body class="min-h-full" style="background-color: var(--light); color: var(--dark);">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WSSXP26S"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <!-- Darkmode 按钮（固定在右上角） -->
    <div class="darkmode-container">
      <Darkmode client:only="react" />
    </div>
    
    <main class="min-h-screen">
      <slot />
    </main>
    
    <!-- Vercel Speed Insights -->
    <SpeedInsights />
    
    <!-- Quartz 客户端脚本 -->
    <script>
      import '../scripts/quartz/popover';
      import '../scripts/quartz/clipboard';
      import '../scripts/quartz/toc';
      import '../scripts/quartz/callout';
      import '../scripts/quartz/checkbox';
    </script>
  </body>
</html>

<style is:global>
  .darkmode-container {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 9999;
  }
</style>
