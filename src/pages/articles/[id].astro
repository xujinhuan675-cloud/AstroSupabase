---
import type { GetStaticPaths } from "astro";
import { getArticleById, getArticles } from '../../lib/articles';
import Layout from '../../layout/Layout.astro';

export const getStaticPaths: GetStaticPaths = async () => {
  const articles = await getArticles();
  return articles.map(article => ({
    params: { id: article.id.toString() },
    props: { article },
  }));
};

const { id } = Astro.params;
const articleId = parseInt(id);

if (isNaN(articleId)) {
  return Astro.redirect('/404');
}

const article = await getArticleById(articleId);

if (!article) {
  return Astro.redirect('/404');
}

const formattedDate = new Date(article.createdAt).toLocaleDateString('zh-TW', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<Layout title={article.title}>
  <nav class="bg-white border-b border-gray-100 mb-10 py-4">
    <div class="max-w-4xl mx-auto px-4 flex items-center">
      <a href="/" class="text-indigo-600 hover:text-indigo-800 text-base font-medium flex items-center gap-1">
        <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
        首頁
      </a>
    </div>
  </nav>

  <article class="max-w-4xl mx-auto px-4 py-10 sm:py-16">
    <header class="mb-12">
      <h1 class="text-4xl font-extrabold text-gray-900 mb-4 leading-tight">
        {article.title}
      </h1>
      <div class="flex items-center text-gray-500 text-sm space-x-2">
        <span>
          {article.authorId}
        </span>
        <span aria-hidden="true">•</span>
        <div>{formattedDate}</div>
      </div>
    </header>
    
    <div class="prose prose-indigo prose-lg max-w-none text-gray-800">
      {article.content.split('\n\n').map((paragraph) => (
        <p>{paragraph}</p>
      ))}
    </div>
  </article>
</Layout>
