/**
 * 移动端全局样式
 * 触摸交互优化、触摸目标尺寸、触摸反馈
 */

/* ===== 触摸目标最小尺寸 ===== */
@media (max-width: 767px) {
  /* 确保所有可点击元素有足够的触摸区域 */
  a,
  button,
  [role="button"],
  input[type="button"],
  input[type="submit"],
  input[type="reset"],
  .clickable {
    min-height: 44px;
    min-width: 44px;
  }

  /* 内联链接使用 padding 扩大触摸区域 */
  article a,
  .content a {
    padding: 0.25rem 0;
    margin: -0.25rem 0;
    display: inline-block;
  }
}

/* ===== 触摸反馈效果 ===== */
@media (hover: none) and (pointer: coarse) {
  /* 按钮触摸反馈 */
  button:active,
  [role="button"]:active,
  .btn:active {
    transform: scale(0.97);
    opacity: 0.9;
  }

  /* 链接触摸反馈 */
  a:active {
    opacity: 0.7;
  }

  /* 卡片触摸反馈 */
  .card:active,
  .article-card:active {
    transform: scale(0.98);
  }

  /* 导航链接触摸反馈 */
  .nav-link:active,
  .mobile-nav-link:active {
    background: var(--highlight);
  }
}

/* ===== 移动端排版优化 ===== */
@media (max-width: 767px) {
  /* 基础字号和行高 */
  article,
  .content {
    font-size: 1rem; /* 16px */
    line-height: 1.75;
  }

  /* 标题字号缩放 */
  article h1,
  .content h1 {
    font-size: 1.75rem; /* 28px */
    line-height: 1.3;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }

  article h2,
  .content h2 {
    font-size: 1.5rem; /* 24px */
    line-height: 1.35;
    margin-top: 1.25rem;
    margin-bottom: 0.5rem;
  }

  article h3,
  .content h3 {
    font-size: 1.25rem; /* 20px */
    line-height: 1.4;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
  }

  article h4,
  .content h4 {
    font-size: 1.125rem; /* 18px */
    line-height: 1.4;
  }

  article h5,
  article h6,
  .content h5,
  .content h6 {
    font-size: 1rem; /* 16px */
    line-height: 1.5;
  }

  /* 段落间距 */
  article p,
  .content p {
    margin: 0.875rem 0;
  }

  /* 列表间距 */
  article ul,
  article ol,
  .content ul,
  .content ol {
    padding-left: 1.25rem;
  }

  article li,
  .content li {
    margin: 0.375rem 0;
  }
}

/* ===== 代码块移动端优化 ===== */
@media (max-width: 767px) {
  article pre,
  .content pre {
    position: relative;
    margin: 1rem -1rem;
    padding: 1rem;
    border-radius: 0;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* 代码块滚动提示 */
  article pre::after,
  .content pre::after {
    content: '← 滑动查看 →';
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
    font-size: 0.75rem;
    color: var(--gray);
    opacity: 0.6;
    pointer-events: none;
  }

  /* 代码块内代码样式 */
  article pre code,
  .content pre code {
    font-size: 0.8125rem;
    line-height: 1.5;
  }

  /* 行内代码 */
  article code:not(pre code),
  .content code:not(pre code) {
    font-size: 0.875rem;
    padding: 0.125rem 0.375rem;
    word-break: break-word;
  }
}

/* ===== 表格移动端优化 ===== */
@media (max-width: 767px) {
  /* 表格容器 */
  .table-wrapper,
  article > table,
  .content > table {
    display: block;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    margin: 1rem 0;
  }

  article table,
  .content table {
    min-width: 500px;
  }

  /* 固定首列 */
  article table th:first-child,
  article table td:first-child,
  .content table th:first-child,
  .content table td:first-child {
    position: sticky;
    left: 0;
    background: var(--light);
    z-index: 1;
    box-shadow: 2px 0 4px rgba(0, 0, 0, 0.1);
  }

  article th,
  article td,
  .content th,
  .content td {
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
    white-space: nowrap;
  }
}

/* ===== 图片移动端优化 ===== */
@media (max-width: 767px) {
  article img,
  .content img {
    max-width: 100%;
    height: auto;
    margin: 1rem 0;
  }

  /* 全宽图片 */
  article img.full-width,
  .content img.full-width {
    width: calc(100% + 2rem);
    max-width: calc(100% + 2rem);
    margin-left: -1rem;
    margin-right: -1rem;
    border-radius: 0;
  }
}

/* ===== 引用块移动端优化 ===== */
@media (max-width: 767px) {
  article blockquote,
  .content blockquote {
    margin: 1rem 0;
    padding: 0.75rem 1rem;
    border-left-width: 3px;
    font-size: 0.9375rem;
  }
}

/* ===== 禁用不必要的动画 ===== */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ===== 安全区域适配 (iPhone X+) ===== */
@supports (padding: env(safe-area-inset-bottom)) {
  .mobile-toc,
  .fixed-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }

  .main-nav {
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }
}
