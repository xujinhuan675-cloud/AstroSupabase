# ⚡ 快速修复指南

## 🎯 已完成的修复

### ✅ 修复1：三栏布局错乱
- **问题**: 页面显示为一列，而不是预期的三栏布局
- **原因**: CSS Grid 配置错误
- **解决**: 更新 `src/styles/quartz/layout.css`

### ✅ 修复2：首页不显示文章
- **问题**: 导入的文章没有显示在首页上
- **原因**: 查询函数没有过滤已发布的文章
- **解决**: 更新 `src/lib/articles.ts`，添加发布状态过滤

### ✅ 新增：诊断工具
- **工具**: `scripts/diagnose-db.ts`
- **用途**: 快速检查数据库数据状态
- **命令**: `npm run diagnose`

---

## 🚀 立即验证修复

### 步骤 1：本地测试
```bash
cd F:\IOTO-Doc\AstroSupabase

# 安装依赖（如果未安装）
npm install

# 运行诊断
npm run diagnose

# 启动开发服务器
npm run dev
```

### 步骤 2：检查布局
访问 http://localhost:3000

您应该看到：
- ✅ **左侧栏**: 标题、搜索、导航菜单
- ✅ **中间**: 文章列表卡片（6篇）
- ✅ **右侧**: （如果有文章详情页）目录、图谱、链接

### 步骤 3：检查内容
- 点击任意文章卡片进入详情页
- 验证详情页也是三栏布局
- 检查响应式设计（缩小浏览器测试）

---

## 📝 诊断脚本输出解读

运行 `npm run diagnose` 后，检查这些关键指标：

```
1️⃣  检查文章总数:
   总数: X  ← 应该 > 0

2️⃣  检查已发布文章:
   已发布: X  ← 应该 > 0

3️⃣  文章详情:
   Status: published  ← 必须是 published
   Published: YYYY-MM-DDTHH:mm:ss.sssZ  ← 必须有时间戳

6️⃣  测试首页查询 (getArticles(6)):
   应该显示: X 篇文章  ← 就是首页能显示的文章数
```

---

## 🔧 常见问题快速解决

### 问题：首页仍然没有文章
**检查清单**:
- [ ] 运行 `npm run diagnose`，检查文章总数 > 0
- [ ] 检查文章的 `Status` 字段是否都是 `'published'`
- [ ] 检查 `publishedAt` 是否都有时间戳
- [ ] 刷新浏览器缓存：`Ctrl+Shift+Delete` 然后 `Ctrl+F5`

### 问题：布局仍然是一列
**检查清单**:
- [ ] 检查浏览器开发者工具 → Elements，查看是否应用了 CSS
- [ ] 清除浏览器缓存：`Ctrl+Shift+Delete`
- [ ] 硬刷新：`Ctrl+F5`
- [ ] 尝试另一个浏览器

### 问题：无法导入新文章
**检查清单**:
- [ ] 确保 GitHub Secrets 已配置（DATABASE_URL, DEFAULT_AUTHOR_ID）
- [ ] 查看 GitHub Actions 日志检查导入错误
- [ ] 本地测试：`npm run import:git`（需要设置 DATABASE_URL）

---

## 📤 推送到 GitHub（触发自动部署）

```bash
# 1. 添加所有更改
git add .

# 2. 提交
git commit -m "fix: 修复三栏布局和首页文章查询"

# 3. 推送（自动触发 GitHub Actions）
git push

# 4. 等待部署完成（检查 GitHub Actions 标签页）
```

### GitHub Actions 会自动：
1. 检出代码
2. 设置 Node.js 18
3. 安装依赖
4. **导入 content/ 目录的 Markdown 文件**
5. 构建项目
6. **部署到 Vercel**

---

## ✨ 验证 Vercel 部署

部署完成后（约 2-5 分钟）：

1. 访问您的 Vercel 项目 URL：https://astrosupabase.vercel.app
2. 检查首页是否显示：
   - ✅ 三栏布局
   - ✅ 文章列表
   - ✅ 正确的标题和内容

### 如果部署后仍有问题
```bash
# 强制重新部署
vercel deploy --prod --force
```

---

## 📊 修复前后对比

### 修复前 ❌
```
页面布局：┌─────────────────────┐
         │ 左侧栏              │
         ├─────────────────────┤
         │ 内容                │
         ├─────────────────────┤
         │ 右侧栏              │
         └─────────────────────┘
         (全部在一列)

首页文章：显示 0 篇
```

### 修复后 ✅
```
页面布局：┌────────┬──────────┬────────┐
         │左侧栏  │ 中间内容 │右侧栏  │
         │        │          │        │
         │        │          │        │
         └────────┴──────────┴────────┘
         (三栏布局，响应式支持)

首页文章：显示 6 篇最新已发布文章
```

---

## 📚 文档和工具

| 文件/命令 | 用途 | 用法 |
|---------|------|------|
| `FIXES_SUMMARY.md` | 详细修复说明 | 查看完整的修复文档 |
| `npm run diagnose` | 数据库诊断 | 快速检查数据状态 |
| `npm run dev` | 本地开发 | 启动开发服务器 |
| `npm run import:git` | 本地导入 | 测试 Markdown 导入 |
| `npm run deploy` | 本地部署 | 导入 + 部署到 Vercel |

---

## 🎉 完成！

所有修复已完成。现在系统应该：
1. ✅ 正确显示三栏布局
2. ✅ 首页显示已发布的文章
3. ✅ GitHub Actions 自动导入和部署
4. ✅ 诊断工具可用于快速调试

**下一步**: 
- 测试新的 Markdown 文章导入
- 探索知识图谱功能
- 自定义首页样式

---

**最后更新**: 2025-10-30
**状态**: ✅ 就绪
